
/**
 * dingo-coder
 * Version: 0.1.2
 * Copyright 2015 - 2015 Forest
 */
 define(function(require,a,b){"use strict";var c,d,e,f;return c=require("codemirror/lib/codemirror"),f=require("./mode"),e=require("../lib/beautify/index"),d=function(){function a(a){var b,d,e;this.editor=a,this.container=this.editor.container,this.element=this.editor.element,e=this,b=0,this.event_bind(),this.typelist=[],this.editor.ifr.codeList.find("textarea").each(function(){var a;return b++,a=$(this).attr("code"),e.typelist.push(a),require(["codemirror/mode/"+f[a].mode+"/"+f[a].mode],function(d){return function(){var g,h,i;return b--,i=$("<div class='mode-tab' codetype='code"+a+"'>"+a+"<div class='arrow-up '></div></div>"),e.container.find("#mode-tabs").append(i),h=document.createElement("textarea"),h.id="code"+a,e.container.find("#code-editor").append(h),e.editor[a+"_editor"]=c.fromTextArea(e.container.find("#"+h.id)[0],{theme:"monokai",lineNumbers:!0,matchBrackets:!0,mode:""+f[a].type}),e.container.find("#code"+a).next().prepend("<div class='remind'>"+a+"</div>"),g=$(d).val(),g=e.code_format(a,g),e.element.setAttribute(a,g),"js"===a||"css"===a||"html"===a?e.editor[a+"_editor"].on("change",function(){return e.editor.ifr.refresh()}):void 0}}(this))}),d=setInterval(function(a){return function(){var c,e,f,g;if(0===b){for(null===a.editor.ifr.ifr&&a.editor.ifr.remove(),a.typelist=a.typelist.reverse(),g=a.typelist,e=0,f=g.length;f>e;e++)c=g[e],a.fixlist(c);return a.container.find(".mode-tab").eq(0).trigger("click"),clearInterval(d)}}}(this),100)}return a.prototype.fixlist=function(a){return this.container.find("div[codetype=code"+a+"]").prependTo(this.container.find("#mode-tabs")),this.container.find("#code"+a).next().prependTo(this.container.find("#code-editor")),this.container.find("#code"+a).prependTo(this.container.find("#code-editor"))},a.prototype.code_format=function(a,b){switch(b=b.trim(),a){case"html":b=e.html_beautify(b);break;case"css":b=e.css_beautify(b);break;case"js":b=e.js_beautify(b)}return b},a.prototype.event_bind=function(){var a;return a=this,this.container.find("#mode-tabs").delegate("div","click",function(){var b;if(!$(this).hasClass("active"))return a.container.find(".mode-tab").removeClass("active"),$(this).addClass("active"),a.container.find(".CodeMirror").removeClass("expansiondown"),a.container.find(".CodeMirror").hide(),b=$(this).attr("codetype"),a.container.find("#"+b).next().show()}),this.container.find(".mode").on("click",function(b){return function(){return b.element.layout++,a.editor.layout.set_layout()}}(this))},a}(),b.exports=d});