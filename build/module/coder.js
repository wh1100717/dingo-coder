
/**
 * dingo-coder
 * Version: 0.1.2
 * Copyright 2015 - 2015 Forest
 */
 define(function(require,a,b){"use strict";var c,d,e,f;return c=require("codemirror/lib/codemirror"),e=require("./beautify/index"),f=require("./mode"),d=function(){function a(a,b,d){var e,g,h,i;this.container=a,this.editor=b,this.element=d,i=this,g=0,e=$("<div>"+this.element.innerHTML+"</div>"),this.event_bind(),this.ififrame=!1,this.typelist=[],e.find("textarea").each(function(){var a;return g++,a=$(this).attr("code"),i.typelist.push(a),require(["codemirror/mode/"+f[a].mode+"/"+f[a].mode],function(b){return function(){var d,e,h;return g--,h=$("<div class='mode-tab' codetype='code"+a+"'>"+a+"<div class='arrow-up '></div></div>"),i.container.find("#mode-tabs").append(h),e=document.createElement("textarea"),e.id="code"+a,i.container.find("#code-editor").append(e),i.editor[a+"_editor"]=c.fromTextArea(i.container.find("#"+e.id)[0],{theme:"monokai",lineNumbers:!0,matchBrackets:!0,mode:""+f[a].type}),i.container.find("#code"+a).next().prepend("<div class='remind'>"+a+"</div>"),d=$(b).val(),d=i.code_format(a,d),i.element.setAttribute(a,d),"js"===a||"css"===a||"html"===a?("html"===a&&(i.ififrame=!0),i.editor[a+"_editor"].on("change",function(){return i.editor.ifr.refresh()})):void 0}}(this))}),h=setInterval(function(a){return function(){var b,c,d,e;if(0===g){for(a.ififrame===!1&&a.editor.ifr.remove(),a.typelist=a.typelist.reverse(),e=a.typelist,c=0,d=e.length;d>c;c++)b=e[c],a.fixlist(b);return a.container.find(".mode-tab").eq(0).trigger("click"),clearInterval(h)}}}(this),100)}return a.prototype.fixlist=function(a){return this.container.find("div[codetype=code"+a+"]").prependTo(this.container.find("#mode-tabs")),this.container.find("#code"+a).next().prependTo(this.container.find("#code-editor")),this.container.find("#code"+a).prependTo(this.container.find("#code-editor"))},a.prototype.code_format=function(a,b){switch(b=b.trim(),a){case"html":b=e.html_beautify(b);break;case"css":b=e.css_beautify(b);break;case"js":b=e.js_beautify(b)}return b},a.prototype.event_bind=function(){var a;return a=this,this.container.find("#mode-tabs").delegate("div","click",function(){var b;if(!$(this).hasClass("active"))return a.container.find(".mode-tab").removeClass("active"),$(this).addClass("active"),a.container.find(".CodeMirror").removeClass("expansiondown"),a.container.find(".CodeMirror").hide(),b=$(this).attr("codetype"),a.container.find("#"+b).next().show()}),this.container.find(".mode").on("click",function(b){return function(){return b.element.layout++,a.editor.layout.set_layout()}}(this))},a}(),b.exports=d});